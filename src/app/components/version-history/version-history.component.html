<div class="version-history-container">
    <button
            (click)="togglePanel()"
            aria-label="Toggle version history panel"
            class="toggle-button"
            matTooltip="Version History">
        <mat-icon>history</mat-icon>
    </button>

    <div [class.open]="isOpen" class="version-panel">
        <div class="panel-header">
            <h2>Version History</h2>
            <button
                    (click)="togglePanel()"
                    aria-label="Close panel"
                    mat-icon-button>
                <mat-icon>close</mat-icon>
            </button>
        </div>

        <div class="panel-content">
            <div *ngIf="versions.length === 0" class="no-versions">
                <p>No saved versions yet.</p>
                <p class="hint">Versions are automatically saved when you make changes to your JSON.</p>
            </div>

            <div *ngIf="versions.length > 0" class="versions-list">
                <div
                        (click)="loadVersion(version)"
                        *ngFor="let version of versions"
                        class="version-item">

                    <div class="version-info">
                        <div *ngIf="editingVersionId !== version.id" class="version-name">
                            {{ version.name || 'Unnamed version' }}
                            <button
                                    (click)="startEditName(version, $event)"
                                    aria-label="Edit version name"
                                    class="edit-button"
                                    mat-icon-button>
                                <mat-icon>edit</mat-icon>
                            </button>
                        </div>

                        <div *ngIf="editingVersionId === version.id" class="version-name-edit">
                            <input
                                    (click)="$event.stopPropagation()"
                                    [formControl]="versionNameControl"
                                    placeholder="Version name">
                            <button
                                    (click)="saveVersionName(version, $event)"
                                    aria-label="Save version name"
                                    mat-icon-button>
                                <mat-icon>check</mat-icon>
                            </button>
                        </div>

                        <div class="version-timestamp">
                            {{ formatDate(version.timestamp) }}
                        </div>
                    </div>

                    <div class="version-actions">
                        <button
                                (click)="deleteVersion(version.id, $event)"
                                aria-label="Delete version"
                                mat-icon-button
                                matTooltip="Delete version">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div *ngIf="versions.length > 0" class="panel-footer">
            <button
                    (click)="clearHistory()"
                    aria-label="Clear all history"
                    color="warn"
                    mat-button>
                Clear All History
            </button>
        </div>
    </div>
</div>